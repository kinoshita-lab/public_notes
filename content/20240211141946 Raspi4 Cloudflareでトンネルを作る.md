# 20240211141946 Raspi4 Cloudflareでトンネルを作る
#raspi #cloudflare 

## 注意
色々なサイトを参考にしたけど、変化が激しいので100%参考になることは無かった。おそらくこのメモもすぐに陳腐化すると思う。私はこの分野の専門ではないので、全然わからないで適当にやっている。

## トンネルとは
[トンネリングとは？| ネットワークにおけるトンネリング | Cloudflare](https://www.cloudflare.com/ja-jp/learning/network-layer/what-is-tunneling/)

## 前提
- ドメインを持っている
- ネームサーバーをcloudflareに移管できる
- ブラウザでがんばってやろうとしたが挫折。 cliの方法を試す  [Create a locally-managed tunnel (CLI) · Cloudflare Zero Trust docs](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/create-local-tunnel/)

## cloudflareでアカウントを作る

[Cloudflare | Web Performance & Security](https://dash.cloudflare.com/sign-up)
ここからサインアップしてアカウントを作る。

## cloudflareをインストールする
raspi4にcloudflaredをインストールする。
[Downloads · Cloudflare Zero Trust docs](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/downloads/) から、 amd64/x86-64 の .deb をダウンロード、
```
$ sudo dpkg -i coudflared-linux-amd64.deb
```

### 専用ユーザーを作成

```
$ sudo groupadd --system cloudflare

$ sudo useradd --system \
--gid cloudflare \
--create-home \
--home-dir /var/lib/cloudflare \
--comment "Cloudflaire" \
cloudflare

$ sudo passwd cloudflare
New password:
Retype new password:
passwd: password updated successfully

kazbo@saipi4:~ $ su cloudflare
Password:
cloudflare@saipi4:/home/kazbo $
```
以降作業はこのユーザー(cloudflare)で実施
## cf.
- [Cloudflare Tunnel を使って自宅サーバを公開する - hoge な blog](https://akkyorz.hatenablog.com/entry/2022/12/15/012728)
